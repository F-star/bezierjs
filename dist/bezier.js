(()=>{var{abs:F,cos:b,sin:R,acos:rt,atan2:U,sqrt:S,pow:C}=Math;function J(o){return o<0?-C(-o,1/3):C(o,1/3)}var V=Math.PI,X=2*V,j=V/2,st=1e-6,Y=Number.MAX_SAFE_INTEGER||9007199254740991,Q=Number.MIN_SAFE_INTEGER||-9007199254740991,ot={x:0,y:0,z:0},h={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(o,n){let e=n(o),i=e.x*e.x+e.y*e.y;return typeof e.z!="undefined"&&(i+=e.z*e.z),S(i)},compute:function(o,n,e){if(o===0)return n[0].t=0,n[0];let i=n.length-1;if(o===1)return n[i].t=1,n[i];let s=1-o,u=n;if(i===0)return n[0].t=o,n[0];if(i===1){let f={x:s*u[0].x+o*u[1].x,y:s*u[0].y+o*u[1].y,t:o};return e&&(f.z=s*u[0].z+o*u[1].z),f}if(i<4){let f=s*s,c=o*o,a,x,l,y=0;i===2?(u=[u[0],u[1],u[2],ot],a=f,x=s*o*2,l=c):i===3&&(a=f*s,x=f*o*3,l=s*c*3,y=o*c);let m={x:a*u[0].x+x*u[1].x+l*u[2].x+y*u[3].x,y:a*u[0].y+x*u[1].y+l*u[2].y+y*u[3].y,t:o};return e&&(m.z=a*u[0].z+x*u[1].z+l*u[2].z+y*u[3].z),m}let r=JSON.parse(JSON.stringify(n));for(;r.length>1;){for(let f=0;f<r.length-1;f++)r[f]={x:r[f].x+(r[f+1].x-r[f].x)*o,y:r[f].y+(r[f+1].y-r[f].y)*o},typeof r[f].z!="undefined"&&(r[f]=r[f].z+(r[f+1].z-r[f].z)*o);r.splice(r.length-1,1)}return r[0].t=o,r[0]},computeWithRatios:function(o,n,e,i){let s=1-o,u=e,r=n,f=u[0],c=u[1],a=u[2],x=u[3],l;if(f*=s,c*=o,r.length===2)return l=f+c,{x:(f*r[0].x+c*r[1].x)/l,y:(f*r[0].y+c*r[1].y)/l,z:i?(f*r[0].z+c*r[1].z)/l:!1,t:o};if(f*=s,c*=2*s,a*=o*o,r.length===3)return l=f+c+a,{x:(f*r[0].x+c*r[1].x+a*r[2].x)/l,y:(f*r[0].y+c*r[1].y+a*r[2].y)/l,z:i?(f*r[0].z+c*r[1].z+a*r[2].z)/l:!1,t:o};if(f*=s,c*=1.5*s,a*=3*s,x*=o*o*o,r.length===4)return l=f+c+a+x,{x:(f*r[0].x+c*r[1].x+a*r[2].x+x*r[3].x)/l,y:(f*r[0].y+c*r[1].y+a*r[2].y+x*r[3].y)/l,z:i?(f*r[0].z+c*r[1].z+a*r[2].z+x*r[3].z)/l:!1,t:o}},derive:function(o,n){let e=[];for(let i=o,s=i.length,u=s-1;s>1;s--,u--){let r=[];for(let f=0,c;f<u;f++)c={x:u*(i[f+1].x-i[f].x),y:u*(i[f+1].y-i[f].y)},n&&(c.z=u*(i[f+1].z-i[f].z)),r.push(c);e.push(r),i=r}return e},between:function(o,n,e){return n<=o&&o<=e||h.approximately(o,n)||h.approximately(o,e)},approximately:function(o,n,e){return F(o-n)<=(e||st)},length:function(o){let n=.5,e=h.Tvalues.length,i=0;for(let s=0,u;s<e;s++)u=n*h.Tvalues[s]+n,i+=h.Cvalues[s]*h.arcfn(u,o);return n*i},map:function(o,n,e,i,s){let u=e-n,r=s-i,f=o-n,c=f/u;return i+r*c},lerp:function(o,n,e){let i={x:n.x+o*(e.x-n.x),y:n.y+o*(e.y-n.y)};return n.z!==void 0&&e.z!==void 0&&(i.z=n.z+o*(e.z-n.z)),i},pointToString:function(o){let n=o.x+"/"+o.y;return typeof o.z!="undefined"&&(n+="/"+o.z),n},pointsToString:function(o){return"["+o.map(h.pointToString).join(", ")+"]"},copy:function(o){return JSON.parse(JSON.stringify(o))},angle:function(o,n,e){let i=n.x-o.x,s=n.y-o.y,u=e.x-o.x,r=e.y-o.y,f=i*r-s*u,c=i*u+s*r;return U(f,c)},round:function(o,n){let e=""+o,i=e.indexOf(".");return parseFloat(e.substring(0,i+1+n))},dist:function(o,n){let e=o.x-n.x,i=o.y-n.y;return S(e*e+i*i)},closest:function(o,n){let e=C(2,63),i,s;return o.forEach(function(u,r){s=h.dist(n,u),s<e&&(e=s,i=r)}),{mdist:e,mpos:i}},abcratio:function(o,n){if(n!==2&&n!==3)return!1;if(typeof o=="undefined")o=.5;else if(o===0||o===1)return o;let e=C(o,n)+C(1-o,n),i=e-1;return F(i/e)},projectionratio:function(o,n){if(n!==2&&n!==3)return!1;if(typeof o=="undefined")o=.5;else if(o===0||o===1)return o;let e=C(1-o,n),i=C(o,n)+e;return e/i},lli8:function(o,n,e,i,s,u,r,f){let c=(o*i-n*e)*(s-r)-(o-e)*(s*f-u*r),a=(o*i-n*e)*(u-f)-(n-i)*(s*f-u*r),x=(o-e)*(u-f)-(n-i)*(s-r);return x==0?!1:{x:c/x,y:a/x}},lli4:function(o,n,e,i){let s=o.x,u=o.y,r=n.x,f=n.y,c=e.x,a=e.y,x=i.x,l=i.y;return h.lli8(s,u,r,f,c,a,x,l)},lli:function(o,n){return h.lli4(o,o.c,n,n.c)},makeline:function(o,n){return new d(o.x,o.y,(o.x+n.x)/2,(o.y+n.y)/2,n.x,n.y)},findbbox:function(o){let n=Y,e=Y,i=Q,s=Q;return o.forEach(function(u){let r=u.bbox();n>r.x.min&&(n=r.x.min),e>r.y.min&&(e=r.y.min),i<r.x.max&&(i=r.x.max),s<r.y.max&&(s=r.y.max)}),{x:{min:n,mid:(n+i)/2,max:i,size:i-n},y:{min:e,mid:(e+s)/2,max:s,size:s-e}}},shapeintersections:function(o,n,e,i,s){if(!h.bboxoverlap(n,i))return[];let u=[],r=[o.startcap,o.forward,o.back,o.endcap],f=[e.startcap,e.forward,e.back,e.endcap];return r.forEach(function(c){c.virtual||f.forEach(function(a){if(a.virtual)return;let x=c.intersects(a,s);x.length>0&&(x.c1=c,x.c2=a,x.s1=o,x.s2=e,u.push(x))})}),u},makeshape:function(o,n,e){let i=n.points.length,s=o.points.length,u=h.makeline(n.points[i-1],o.points[0]),r=h.makeline(o.points[s-1],n.points[0]),f={startcap:u,forward:o,back:n,endcap:r,bbox:h.findbbox([u,o,n,r])};return f.intersections=function(c){return h.shapeintersections(f,f.bbox,c,c.bbox,e)},f},getminmax:function(o,n,e){if(!e)return{min:0,max:0};let i=Y,s=Q,u,r;e.indexOf(0)===-1&&(e=[0].concat(e)),e.indexOf(1)===-1&&e.push(1);for(let f=0,c=e.length;f<c;f++)u=e[f],r=o.get(u),r[n]<i&&(i=r[n]),r[n]>s&&(s=r[n]);return{min:i,mid:(i+s)/2,max:s,size:s-i}},align:function(o,n){let e=n.p1.x,i=n.p1.y,s=-U(n.p2.y-i,n.p2.x-e),u=function(r){return{x:(r.x-e)*b(s)-(r.y-i)*R(s),y:(r.x-e)*R(s)+(r.y-i)*b(s)}};return o.map(u)},isLinear:function(o,n){let e=h.align(o,{p1:o[0],p2:o[n]}),i=h.dist(o[0],o[n]);return e.reduce((s,u)=>s+F(u.y),0)<i/50},roots:function(o,n){n=n||{p1:{x:0,y:0},p2:{x:1,y:0}};let e=o.length-1,i=h.align(o,n),s=function(g){return 0<=g&&g<=1};if(e===2){let g=i[0].y,z=i[1].y,P=i[2].y,k=g-2*z+P;if(k!==0){let T=-S(z*z-g*P),A=-g+z,L=-(T+A)/k,N=-(-T+A)/k;return[L,N].filter(s)}else if(z!==P&&k===0)return[(2*z-P)/(2*z-2*P)].filter(s);return[]}let u=i[0].y,r=i[1].y,f=i[2].y,c=i[3].y,a=-u+3*r-3*f+c,x=3*u-6*r+3*f,l=-3*u+3*r,y=u;if(h.approximately(a,0)){if(h.approximately(x,0))return h.approximately(l,0)?[]:[-y/l].filter(s);let g=S(l*l-4*x*y),z=2*x;return[(g-l)/z,(-l-g)/z].filter(s)}x/=a,l/=a,y/=a;let m=(3*l-x*x)/3,v=m/3,_=(2*x*x*x-9*x*l+27*y)/27,M=_/2,E=M*M+v*v*v,O,w,I,p,q;if(E<0){let g=-m/3,z=g*g*g,P=S(z),k=-_/(2*P),T=k<-1?-1:k>1?1:k,A=rt(T),L=J(P),N=2*L;return I=N*b(A/3)-x/3,p=N*b((A+X)/3)-x/3,q=N*b((A+2*X)/3)-x/3,[I,p,q].filter(s)}else{if(E===0)return O=M<0?J(-M):-J(M),I=2*O-x/3,p=-O-x/3,[I,p].filter(s);{let g=S(E);return O=J(-M+g),w=J(M+g),[O-w-x/3].filter(s)}}},droots:function(o){if(o.length===3){let n=o[0],e=o[1],i=o[2],s=n-2*e+i;if(s!==0){let u=-S(e*e-n*i),r=-n+e,f=-(u+r)/s,c=-(-u+r)/s;return[f,c]}else if(e!==i&&s===0)return[(2*e-i)/(2*(e-i))];return[]}if(o.length===2){let n=o[0],e=o[1];return n!==e?[n/(n-e)]:[]}return[]},curvature:function(o,n,e,i,s){let u,r,f,c,a=0,x=0,l=h.compute(o,n),y=h.compute(o,e),m=l.x*l.x+l.y*l.y;if(i?(u=S(C(l.y*y.z-y.y*l.z,2)+C(l.z*y.x-y.z*l.x,2)+C(l.x*y.y-y.x*l.y,2)),r=C(m+l.z*l.z,3/2)):(u=l.x*y.y-l.y*y.x,r=C(m,3/2)),u===0||r===0)return{k:0,r:0};if(a=u/r,x=r/u,!s){let v=h.curvature(o-.001,n,e,i,!0).k,_=h.curvature(o+.001,n,e,i,!0).k;c=(_-a+(a-v))/2,f=(F(_-a)+F(a-v))/2}return{k:a,r:x,dk:c,adk:f}},inflections:function(o){if(o.length<4)return[];let n=h.align(o,{p1:o[0],p2:o.slice(-1)[0]}),e=n[2].x*n[1].y,i=n[3].x*n[1].y,s=n[1].x*n[2].y,u=n[3].x*n[2].y,r=18*(-3*e+2*i+3*s-u),f=18*(3*e-i-3*s),c=18*(s-e);if(h.approximately(r,0)){if(!h.approximately(f,0)){let y=-c/f;if(0<=y&&y<=1)return[y]}return[]}let a=2*r;if(h.approximately(a,0))return[];let x=f*f-4*r*c;if(x<0)return[];let l=Math.sqrt(x);return[(l-f)/a,-(f+l)/a].filter(function(y){return 0<=y&&y<=1})},bboxoverlap:function(o,n){let e=["x","y"],i=e.length;for(let s=0,u,r,f,c;s<i;s++)if(u=e[s],r=o[u].mid,f=n[u].mid,c=(o[u].size+n[u].size)/2,F(r-f)>=c)return!1;return!0},expandbox:function(o,n){n.x.min<o.x.min&&(o.x.min=n.x.min),n.y.min<o.y.min&&(o.y.min=n.y.min),n.z&&n.z.min<o.z.min&&(o.z.min=n.z.min),n.x.max>o.x.max&&(o.x.max=n.x.max),n.y.max>o.y.max&&(o.y.max=n.y.max),n.z&&n.z.max>o.z.max&&(o.z.max=n.z.max),o.x.mid=(o.x.min+o.x.max)/2,o.y.mid=(o.y.min+o.y.max)/2,o.z&&(o.z.mid=(o.z.min+o.z.max)/2),o.x.size=o.x.max-o.x.min,o.y.size=o.y.max-o.y.min,o.z&&(o.z.size=o.z.max-o.z.min)},pairiteration:function(o,n,e){let i=o.bbox(),s=n.bbox(),u=1e5,r=e||.5;if(i.x.size+i.y.size<r&&s.x.size+s.y.size<r)return[(u*(o._t1+o._t2)/2|0)/u+"/"+(u*(n._t1+n._t2)/2|0)/u];let f=o.split(.5),c=n.split(.5),a=[{left:f.left,right:c.left},{left:f.left,right:c.right},{left:f.right,right:c.right},{left:f.right,right:c.left}];a=a.filter(function(l){return h.bboxoverlap(l.left.bbox(),l.right.bbox())});let x=[];return a.length===0||(a.forEach(function(l){x=x.concat(h.pairiteration(l.left,l.right,r))}),x=x.filter(function(l,y){return x.indexOf(l)===y})),x},getccenter:function(o,n,e){let i=n.x-o.x,s=n.y-o.y,u=e.x-n.x,r=e.y-n.y,f=i*b(j)-s*R(j),c=i*R(j)+s*b(j),a=u*b(j)-r*R(j),x=u*R(j)+r*b(j),l=(o.x+n.x)/2,y=(o.y+n.y)/2,m=(n.x+e.x)/2,v=(n.y+e.y)/2,_=l+f,M=y+c,E=m+a,O=v+x,w=h.lli8(l,y,_,M,m,v,E,O),I=h.dist(w,o),p=U(o.y-w.y,o.x-w.x),q=U(n.y-w.y,n.x-w.x),g=U(e.y-w.y,e.x-w.x),z;return p<g?((p>q||q>g)&&(p+=X),p>g&&(z=g,g=p,p=z)):g<q&&q<p?(z=g,g=p,p=z):g+=X,w.s=p,w.e=g,w.r=I,w},numberSort:function(o,n){return o-n}};var D=class{constructor(n){this.curves=[],this._3d=!1,n&&(this.curves=n,this._3d=this.curves[0]._3d)}valueOf(){return this.toString()}toString(){return"["+this.curves.map(function(n){return h.pointsToString(n.points)}).join(", ")+"]"}addCurve(n){this.curves.push(n),this._3d=this._3d||n._3d}length(){return this.curves.map(function(n){return n.length()}).reduce(function(n,e){return n+e})}curve(n){return this.curves[n]}bbox(){let n=this.curves;for(var e=n[0].bbox(),i=1;i<n.length;i++)h.expandbox(e,n[i].bbox());return e}offset(n){let e=[];return this.curves.forEach(function(i){e.push(...i.offset(n))}),new D(e)}};var Z=class extends Bezier{constructor(...n){n.length===4&&(n=[{x:n[0],y:n[1]},{x:n[2],y:n[3]}]),this.setPoints(...n)}};var H=class extends Bezier{constructor(...n){n.length===6&&(n=[{x:n[0],y:n[1]},{x:n[2],y:n[3]},{x:n[4],y:n[5]}]),this.setPoints(...n)}};var K=class extends Bezier{constructor(...n){n.length===6&&(n=[{x:n[0],y:n[1]},{x:n[2],y:n[3]},{x:n[4],y:n[5]}]),this.setPoints(...n)}};var $=class extends Bezier{constructor(...n){n.length===8&&(n=[{x:n[0],y:n[1]},{x:n[2],y:n[3]},{x:n[4],y:n[5]},{x:n[6],y:n[7]}]),this.setPoints(...n)}};var B=class extends Bezier{constructor(...n){n.length===9&&(n=[{x:n[0],y:n[1],z:n[2]},{x:n[3],y:n[4],z:n[5]},{x:n[6],y:n[7],z:n[8]}]),this.setPoints(...n)}};var tt=class extends Bezier{constructor(...n){n.length===12&&(n=[{x:n[0],y:n[1],z:n[2]},{x:n[3],y:n[4],z:n[5]},{x:n[6],y:n[7],z:n[8]},{x:n[9],y:n[10],z:n[11]}]),this.setPoints(...n)}};var{abs:W,min:nt,max:et,cos:ut,sin:ft,acos:ct,sqrt:G,PI:at}=Math,d=class{constructor(n){let e=n&&n.forEach?n:Array.from(arguments).slice(),i=!1;if(typeof e[0]=="object"){i=e.length;let l=[];e.forEach(function(y){["x","y","z"].forEach(function(m){typeof y[m]!="undefined"&&l.push(y[m])})}),e=l}let s=!1,u=e.length;if(i){if(i>4){if(arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");s=!0}}else if(u!==6&&u!==8&&u!==9&&u!==12&&arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");let r=this._3d=!s&&(u===9||u===12)||n&&n[0]&&typeof n[0].z!="undefined",f=this.points=[];for(let l=0,y=r?3:2;l<u;l+=y){var c={x:e[l],y:e[l+1]};r&&(c.z=e[l+2]),f.push(c)}let a=this.dims=["x","y"];r&&a.push("z"),this.dimlen=a.length;let x=this.order=f.length-1;this._linear=h.isLinear(f,x),this._lut=[],this._t1=0,this._t2=1,this.update()}static quadraticFromPoints(n,e,i,s){if(typeof s=="undefined"&&(s=.5),s===0)return new d(e,e,i);if(s===1)return new d(n,e,e);let u=d.getABC(2,n,e,i,s);return new d(n,u.A,i)}static cubicFromPoints(n,e,i,s,u){typeof s=="undefined"&&(s=.5);let r=d.getABC(3,n,e,i,s);typeof u=="undefined"&&(u=h.dist(e,r.C));let f=u*(1-s)/s,c=h.dist(n,i),a=(i.x-n.x)/c,x=(i.y-n.y)/c,l=u*a,y=u*x,m=f*a,v=f*x,_={x:e.x-l,y:e.y-y},M={x:e.x+m,y:e.y+v},E=r.A,O={x:E.x+(_.x-E.x)/(1-s),y:E.y+(_.y-E.y)/(1-s)},w={x:E.x+(M.x-E.x)/s,y:E.y+(M.y-E.y)/s},I={x:n.x+(O.x-n.x)/s,y:n.y+(O.y-n.y)/s},p={x:i.x+(w.x-i.x)/(1-s),y:i.y+(w.y-i.y)/(1-s)};return new d(n,I,p,i)}static getUtils(){return h}getUtils(){return d.getUtils()}static get PolyBezier(){return D}valueOf(){return this.toString()}toString(){return h.pointsToString(this.points)}toSVG(){if(this._3d)return!1;let n=this.points,e=n[0].x,i=n[0].y,s=["M",e,i,this.order===2?"Q":"C"];for(let u=1,r=n.length;u<r;u++)s.push(n[u].x),s.push(n[u].y);return s.join(" ")}setRatios(n){if(n.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=n,this._lut=[]}verify(){let n=this.coordDigest();n!==this._print&&(this._print=n,this.update())}coordDigest(){return this.points.map(function(n,e){return""+e+n.x+n.y+(n.z?n.z:0)}).join("")}update(){this._lut=[],this.dpoints=h.derive(this.points,this._3d),this.computedirection()}computedirection(){let n=this.points,e=h.angle(n[0],n[this.order],n[1]);this.clockwise=e>0}length(){return h.length(this.derivative.bind(this))}static getABC(n=2,e,i,s,u=.5){let r=h.projectionratio(u,n),f=1-r,c={x:r*e.x+f*s.x,y:r*e.y+f*s.y},a=h.abcratio(u,n);return{A:{x:i.x+(i.x-c.x)/a,y:i.y+(i.y-c.y)/a},B:i,C:c,S:e,E:s}}getABC(n,e){e=e||this.get(n);let i=this.points[0],s=this.points[this.order];return d.getABC(this.order,i,e,s,n)}getLUT(n){if(this.verify(),n=n||100,this._lut.length===n)return this._lut;this._lut=[],n++,this._lut=[];for(let e=0,i,s;e<n;e++)s=e/(n-1),i=this.compute(s),i.t=s,this._lut.push(i);return this._lut}on(n,e){e=e||5;let i=this.getLUT(),s=[];for(let u=0,r,f=0;u<i.length;u++)r=i[u],h.dist(r,n)<e&&(s.push(r),f+=u/i.length);return s.length?t/=s.length:!1}project(n){let e=this.getLUT(),i=e.length-1,s=h.closest(e,n),u=s.mpos,r=(u-1)/i,f=(u+1)/i,c=.1/i,a=s.mdist,x=r,l=x,y;a+=1;for(let m;x<f+c;x+=c)y=this.compute(x),m=h.dist(n,y),m<a&&(a=m,l=x);return l=l<0?0:l>1?1:l,y=this.compute(l),y.t=l,y.d=a,y}get(n){return this.compute(n)}point(n){return this.points[n]}compute(n){return this.ratios?h.computeWithRatios(n,this.points,this.ratios,this._3d):h.compute(n,this.points,this._3d,this.ratios)}raise(){let n=this.points,e=[n[0]],i=n.length;for(let s=1,u,r;s<i;s++)u=n[s],r=n[s-1],e[s]={x:(i-s)/i*u.x+s/i*r.x,y:(i-s)/i*u.y+s/i*r.y};return e[i]=n[i-1],new d(e)}derivative(n){return h.compute(n,this.dpoints[0],this._3d)}dderivative(n){return h.compute(n,this.dpoints[1],this._3d)}align(){let n=this.points;return new d(h.align(n,{p1:n[0],p2:n[n.length-1]}))}curvature(n){return h.curvature(n,this.dpoints[0],this.dpoints[1],this._3d)}inflections(){return h.inflections(this.points)}normal(n){return this._3d?this.__normal3(n):this.__normal2(n)}__normal2(n){let e=this.derivative(n),i=G(e.x*e.x+e.y*e.y);return{t:n,x:-e.y/i,y:e.x/i}}__normal3(n){let e=this.derivative(n),i=this.derivative(n+.01),s=G(e.x*e.x+e.y*e.y+e.z*e.z),u=G(i.x*i.x+i.y*i.y+i.z*i.z);e.x/=s,e.y/=s,e.z/=s,i.x/=u,i.y/=u,i.z/=u;let r={x:i.y*e.z-i.z*e.y,y:i.z*e.x-i.x*e.z,z:i.x*e.y-i.y*e.x},f=G(r.x*r.x+r.y*r.y+r.z*r.z);r.x/=f,r.y/=f,r.z/=f;let c=[r.x*r.x,r.x*r.y-r.z,r.x*r.z+r.y,r.x*r.y+r.z,r.y*r.y,r.y*r.z-r.x,r.x*r.z-r.y,r.y*r.z+r.x,r.z*r.z];return{t:n,x:c[0]*e.x+c[1]*e.y+c[2]*e.z,y:c[3]*e.x+c[4]*e.y+c[5]*e.z,z:c[6]*e.x+c[7]*e.y+c[8]*e.z}}hull(n){let e=this.points,i=[],s=[],u=0;for(s[u++]=e[0],s[u++]=e[1],s[u++]=e[2],this.order===3&&(s[u++]=e[3]);e.length>1;){i=[];for(let r=0,f,c=e.length-1;r<c;r++)f=h.lerp(n,e[r],e[r+1]),s[u++]=f,i.push(f);e=i}return s}split(n,e){if(n===0&&!!e)return this.split(e).left;if(e===1)return this.split(n).right;let i=this.hull(n),s={left:this.order===2?new d([i[0],i[3],i[5]]):new d([i[0],i[4],i[7],i[9]]),right:this.order===2?new d([i[5],i[4],i[2]]):new d([i[9],i[8],i[6],i[3]]),span:i};return s.left._t1=h.map(0,0,1,this._t1,this._t2),s.left._t2=h.map(n,0,1,this._t1,this._t2),s.right._t1=h.map(n,0,1,this._t1,this._t2),s.right._t2=h.map(1,0,1,this._t1,this._t2),e?(e=h.map(e,n,1,0,1),s.right.split(e).left):s}extrema(){let n={},e=[];return this.dims.forEach(function(i){let s=function(r){return r[i]},u=this.dpoints[0].map(s);n[i]=h.droots(u),this.order===3&&(u=this.dpoints[1].map(s),n[i]=n[i].concat(h.droots(u))),n[i]=n[i].filter(function(r){return r>=0&&r<=1}),e=e.concat(n[i].sort(h.numberSort))}.bind(this)),n.values=e.sort(h.numberSort).filter(function(i,s){return e.indexOf(i)===s}),n}bbox(){let n=this.extrema(),e={};return this.dims.forEach(function(i){e[i]=h.getminmax(this,i,n[i])}.bind(this)),e}overlaps(n){let e=this.bbox(),i=n.bbox();return h.bboxoverlap(e,i)}offset(n,e){if(typeof e!="undefined"){let i=this.get(n),s=this.normal(n),u={c:i,n:s,x:i.x+s.x*e,y:i.y+s.y*e};return this._3d&&(u.z=i.z+s.z*e),u}if(this._linear){let i=this.normal(0),s=this.points.map(function(u){let r={x:u.x+n*i.x,y:u.y+n*i.y};return u.z&&i.z&&(r.z=u.z+n*i.z),r});return[new d(s)]}return this.reduce().map(function(i){return i._linear?i.offset(n)[0]:i.scale(n)})}simple(){if(this.order===3){let s=h.angle(this.points[0],this.points[3],this.points[1]),u=h.angle(this.points[0],this.points[3],this.points[2]);if(s>0&&u<0||s<0&&u>0)return!1}let n=this.normal(0),e=this.normal(1),i=n.x*e.x+n.y*e.y;return this._3d&&(i+=n.z*e.z),W(ct(i))<at/3}reduce(){let n,e=0,i=0,s=.01,u,r=[],f=[],c=this.extrema().values;for(c.indexOf(0)===-1&&(c=[0].concat(c)),c.indexOf(1)===-1&&c.push(1),e=c[0],n=1;n<c.length;n++)i=c[n],u=this.split(e,i),u._t1=e,u._t2=i,r.push(u),e=i;return r.forEach(function(a){for(e=0,i=0;i<=1;)for(i=e+s;i<=1+s;i+=s)if(u=a.split(e,i),!u.simple()){if(i-=s,W(e-i)<s)return[];u=a.split(e,i),u._t1=h.map(e,0,1,a._t1,a._t2),u._t2=h.map(i,0,1,a._t1,a._t2),f.push(u),e=i;break}e<1&&(u=a.split(e,1),u._t1=h.map(e,0,1,a._t1,a._t2),u._t2=a._t2,f.push(u))}),f}translate(n,e,i){i=typeof i=="number"?i:e;let s=this.order,u=this.points.map((r,f)=>(1-f/s)*e+f/s*i);return new d(this.points.map((r,f)=>({x:r.x+n.x*u[f],y:r.y+n.y*u[f]})))}scale(n){let e=this.order,i=!1;if(typeof n=="function"&&(i=n),i&&e===2)return this.raise().scale(i);let s=this.clockwise,u=this.points;if(this._linear)return this.translate(this.normal(0),i?i(0):n,i?i(1):n);let r=i?i(0):n,f=i?i(1):n,c=[this.offset(0,10),this.offset(1,10)],a=[],x=h.lli4(c[0],c[0].c,c[1],c[1].c);if(!x)throw new Error("cannot scale this curve. Try reducing it first.");return[0,1].forEach(function(l){let y=a[l*e]=h.copy(u[l*e]);y.x+=(l?f:r)*c[l].n.x,y.y+=(l?f:r)*c[l].n.y}),i?([0,1].forEach(function(l){if(!(e===2&&!!l)){var y=u[l+1],m={x:y.x-x.x,y:y.y-x.y},v=i?i((l+1)/e):n;i&&!s&&(v=-v);var _=G(m.x*m.x+m.y*m.y);m.x/=_,m.y/=_,a[l+1]={x:y.x+v*m.x,y:y.y+v*m.y}}}),new d(a)):([0,1].forEach(l=>{if(e===2&&!!l)return;let y=a[l*e],m=this.derivative(l),v={x:y.x+m.x,y:y.y+m.y};a[l+1]=h.lli4(y,v,x,u[l+1])}),new d(a))}outline(n,e,i,s){if(e=e===void 0?n:e,this._linear){let p=this.normal(0),q=this.points[0],g=this.points[this.points.length-1],z,P,k;i===void 0&&(i=n,s=e),z={x:q.x+p.x*n,y:q.y+p.y*n},k={x:g.x+p.x*i,y:g.y+p.y*i},P={x:(z.x+k.x)/2,y:(z.y+k.y)/2};let T=[z,P,k];z={x:q.x-p.x*e,y:q.y-p.y*e},k={x:g.x-p.x*s,y:g.y-p.y*s},P={x:(z.x+k.x)/2,y:(z.y+k.y)/2};let A=[k,P,z],L=h.makeline(A[2],T[0]),N=h.makeline(T[2],A[0]),it=[L,new d(T),N,new d(A)];return new D(it)}let u=this.reduce(),r=u.length,f=[],c=[],a,x=0,l=this.length(),y=typeof i!="undefined"&&typeof s!="undefined";function m(p,q,g,z,P){return function(k){let T=z/g,A=(z+P)/g,L=q-p;return h.map(k,0,1,p+T*L,p+A*L)}}u.forEach(function(p){let q=p.length();y?(f.push(p.scale(m(n,i,l,x,q))),c.push(p.scale(m(-e,-s,l,x,q)))):(f.push(p.scale(n)),c.push(p.scale(-e))),x+=q}),c=c.map(function(p){return a=p.points,a[3]?p.points=[a[3],a[2],a[1],a[0]]:p.points=[a[2],a[1],a[0]],p}).reverse();let v=f[0].points[0],_=f[r-1].points[f[r-1].points.length-1],M=c[r-1].points[c[r-1].points.length-1],E=c[0].points[0],O=h.makeline(M,v),w=h.makeline(_,E),I=[O].concat(f).concat([w]).concat(c);return new D(I)}outlineshapes(n,e,i){e=e||n;let s=this.outline(n,e).curves,u=[];for(let r=1,f=s.length;r<f/2;r++){let c=h.makeshape(s[r],s[f-r],i);c.startcap.virtual=r>1,c.endcap.virtual=r<f/2-1,u.push(c)}return u}intersects(n,e){return n?n.p1&&n.p2?this.lineIntersects(n):(n instanceof d&&(n=n.reduce()),this.curveintersects(this.reduce(),n,e)):this.selfintersects(e)}lineIntersects(n){let e=nt(n.p1.x,n.p2.x),i=nt(n.p1.y,n.p2.y),s=et(n.p1.x,n.p2.x),u=et(n.p1.y,n.p2.y);return h.roots(this.points,n).filter(r=>{var f=this.get(r);return h.between(f.x,e,s)&&h.between(f.y,i,u)})}selfintersects(n){let e=this.reduce(),i=e.length-2,s=[];for(let u=0,r,f,c;u<i;u++)f=e.slice(u,u+1),c=e.slice(u+2),r=this.curveintersects(f,c,n),s.push(...r);return s}curveintersects(n,e,i){let s=[];n.forEach(function(r){e.forEach(function(f){r.overlaps(f)&&s.push({left:r,right:f})})});let u=[];return s.forEach(function(r){let f=h.pairiteration(r.left,r.right,i);f.length>0&&(u=u.concat(f))}),u}arcs(n){return n=n||.5,this._iterate(n,[])}_error(n,e,i,s){let u=(s-i)/4,r=this.get(i+u),f=this.get(s-u),c=h.dist(n,e),a=h.dist(n,r),x=h.dist(n,f);return W(a-c)+W(x-c)}_iterate(n,e){let i=0,s=1,u;do{u=0,s=1;let r=this.get(i),f,c,a,x,l=!1,y=!1,m,v=s,_=1,M=0;do if(y=l,x=a,v=(i+s)/2,M++,f=this.get(v),c=this.get(s),a=h.getccenter(r,f,c),a.interval={start:i,end:s},l=this._error(a,r,i,s)<=n,m=y&&!l,m||(_=s),l){if(s>=1){if(a.interval.end=_=1,x=a,s>1){let O={x:a.x+a.r*ut(a.e),y:a.y+a.r*ft(a.e)};a.e+=h.angle({x:a.x,y:a.y},O,this.get(1))}break}s=s+(s-i)/2}else s=v;while(!m&&u++<100);if(u>=100)break;x=x||a,e.push(x),i=_}while(s<1);return e}};})();
